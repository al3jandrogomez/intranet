
function convertStringToArrayBufferView(c){var a=new Uint8Array(c.length);for(var b=0;b<c.length;b++){a[b]=c.charCodeAt(b)}return a}function convertArrayBufferViewtoString(a){var c="";for(var b=0;b<a.byteLength;b++){c+=String.fromCharCode(a[b])}return c}function formatPEM(b){var e=b.length;var a="";for(var c=0,d=0;c<e;c++,d++){if(d>63){a=a+"\r\n";d=0}a=a+b[c]}return a}function base64toBlob(c,m){m=m||"";var b=1024;var j=atob(c);var l=j.length;var h=Math.ceil(l/b);var k=new Array(h);for(var d=0;d<h;++d){var a=d*b;var e=Math.min(a+b,l);var n=new Array(e-a);for(var f=a,g=0;f<e;++g,++f){n[g]=j[f].charCodeAt(0)}k[d]=new Uint8Array(n)}return new Blob(k,{type:m})}function isNPAPIPluginsSupported(){var isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;var isFirefox=typeof InstallTrigger!=="undefined";var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;var isChrome=!!window.chrome&&!isOpera;var isIE=
/*@cc_on!@*/
false||!!document.documentMode;return isIE}function signContent(d,b,c,a){return new Promise(function(h,g){var f;var e;if(window.msCrypto){f=window.msCrypto}else{if(window.crypto){f=window.crypto}else{g(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(f.webkitSubtle){e=f.webkitSubtle}else{if(f.subtle){e=f.subtle}else{g(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(d,b).then(function(i){if(i[0]!="0"){g(Error(SDSGL_ERR_03))}e.importKey("pkcs8",rawStringToBuffer(i),{name:"RSASSA-PKCS1-v1_5",hash:{name:c}},false,["sign"]).then(function(j){e.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:c}},j,convertStringToArrayBufferView(a)).then(function(m){var o="";var l=new Uint8Array(m);for(var n=0;n<l.length;n++){o=o+String.fromCharCode(l[n])}var k;k=window.btoa(o);h(k)},function(k){g(Error("Error during signing data: "+k.message))})},function(j){g(Error("Error during importing pkcs8: "+j.message))})},function(i){g(Error("Error during getting pkcs8: "+i.message))})})}function signHash(d,a,c,b){return new Promise(function(h,g){var f;var e;if(window.msCrypto){f=window.msCrypto}else{if(window.crypto){f=window.crypto}else{g(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(f.webkitSubtle){e=f.webkitSubtle}else{if(f.subtle){e=f.subtle}else{g(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(d,a).then(function(k){if(k[0]!="0"){g(Error(SDSGL_ERR_03))}var j;j=formatPEM(window.btoa(k));var i=Module.ccall("jsglibSignFromHashV2","string",["string","number","string","number","number"],[j,j.length,b,b.length,c]);if(!i){g(Error("Error during signing hash"))}h(i)},function(i){g(Error("Error during getting pkcs8: "+i.message))})})}function multiSignHash(f,c,e,b){var a=b[0],d=b[2];return new Promise(function(j,i){var h;var g;if(window.msCrypto){h=window.msCrypto}else{if(window.crypto){h=window.crypto}else{i(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(h.webkitSubtle){g=h.webkitSubtle}else{if(h.subtle){g=h.subtle}else{i(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(f,c).then(function(m){if(m[0]!="0"){i(Error(SDSGL_ERR_03))}var l;l=formatPEM(window.btoa(m));var k=Module.ccall("jsglibSignFromHashV2","string",["string","number","string","number","number"],[l,l.length,d,d.length,e]);if(!k){i(Error("Error during signing hash"))}j(k+"|"+a)},function(k){i(Error("Error during getting pkcs8: "+k.message))})})}function pkcs7FromHash(a,d,e,c,b){return new Promise(function(i,h){var g;var f;if(window.msCrypto){g=window.msCrypto}else{if(window.crypto){g=window.crypto}else{h(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(g.webkitSubtle){f=g.webkitSubtle}else{if(g.subtle){f=g.subtle}else{h(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(d,a).then(function(m){if(m[0]!="0"){h(Error(SDSGL_ERR_03))}var l;l=formatPEM(window.btoa(m));var k=Module.ccall("jsglibSignFromHashV2","string",["string","number","string","number","number"],[l,l.length,b,b.length,c]);if(!k){h(Error("Error during getting pkcs1"))}if(k.substring(0,7)=="[Error]"){h(Error(k))}var j;switch(c){case 2:j="SHA-1";break;case 3:j="SHA-256";break;case 4:j="SHA-384";break;case 5:j="SHA-512";break;default:j="SHA-256"}SDSgLib_encodePKCS7Detached(e,str2ab(window.atob(k)),j).then(function(n){i(n)},function(n){h(Error("Error during getting pkcs7: "+n.message))})},function(j){h(Error("Error during getting pkcs8: "+j.message))})})}function pkcs7FromContent(c,e,f,d,b,a){return new Promise(function(j,i){var h;var g;if(window.msCrypto){h=window.msCrypto}else{if(window.crypto){h=window.crypto}else{i(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(h.webkitSubtle){g=h.webkitSubtle}else{if(h.subtle){g=h.subtle}else{i(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(e,c).then(function(k){if(k[0]!="0"){i(Error(SDSGL_ERR_03))}g.importKey("pkcs8",rawStringToBuffer(k),{name:"RSASSA-PKCS1-v1_5",hash:{name:d}},false,["sign"]).then(function(l){g.sign({name:"RSASSA-PKCS1-v1_5",hash:{name:d}},l,convertStringToArrayBufferView(b)).then(function(m){SDSgLib_encodePKCS7(f,m,d,a?null:str2ab(b)).then(function(n){j(n)},function(n){var o=new Object();o.reason="some reason!";o.message=n;i(o)})},function(m){i(Error("Error during signing data: "+m.message))})},function(l){i(Error("Error during importing pkcs8: "+l.message))})},function(k){i(Error("Error during getting pkcs8: "+k.message))})})}function privateDecrypt(c,a,b){return new Promise(function(g,f){var e;var d;if(window.msCrypto){e=window.msCrypto}else{if(window.crypto){e=window.crypto}else{f(Error("Web Cryptography API not supported. [No Crypto Namespace]"))}}if(e.webkitSubtle){d=e.webkitSubtle}else{if(e.subtle){d=e.subtle}else{f(Error("Web Cryptography API not supported. [No Crypto.Subtle Namespace]"))}}SDSgLib_openPKCS8PrivateKey(c,a).then(function(j){if(j[0]!="0"){f(Error(SDSGL_ERR_03))}var h;h=formatPEM(window.btoa(j));var i=Module.ccall("jsglibPrivateDecryptV2","string",["string","number","string","number"],[h,h.length,b,b.length]);if(!i){f(Error("Error during decrypting data"))}g(i)},function(h){f(Error("Error during getting pkcs8: "+h.message))})})};